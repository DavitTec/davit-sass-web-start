# DAVIT Asset & Deployment Policy

## 1. Overview
This document defines the asset architecture, storage strategy, build pipeline, and deployment workflow for DAVIT multi-domain web projects. It also defines the GitHub Pages-ready project skeleton and GitHub Actions configuration for automated builds using **pnpm**.

This framework supports:
- Multi-domain asset delivery (e.g., davit.ie, davit.in)
- Centralised asset CDN (`assets.davit.ie`)
- Strict separation of editable assets and production assets
- Clean build pipelines (`dist`, `stage`, `archive`, `build`)
- GitHub Pages deployment workflows
- Long-term consistency across DAVIT projects

---

# 2. Asset Architecture

## 2.1 Asset Layers
Assets are divided into three layers:

### **Layer 1 — Editable Source Assets (Local)**
Stored inside the project under:
```
src/assets-dev/
```
These include:
- Raw SVG files (layered, uncleaned)
- High‑resolution image sources
- Favicon PSD/XCF/XD/AI source files
- Unoptimised screenshots or graphic prototypes

These files **never ship to production**.

### **Layer 2 — Build Output Assets (Local)**
Generated by build scripts into:
```
dist/assets/
```
This layer contains:
- Optimised SVGs
- Resized/converted images (e.g., WebP)
- Minified assets
- Auto‑generated sprite sheets

These assets are used in **local development**.

### **Layer 3 — CDN Production Assets (Remote)**
Hosted at:
```
https://assets.davit.ie/
```
This is the **canonical global asset repository**, shared across:
- Multi-domain properties (davit.ie, davit.in)
- Multiple brands
- Multiple themes
- Multiple projects

Examples:
```
https://assets.davit.ie/global/favicon/favicon.ico
https://assets.davit.ie/brands/corp/logo.svg
https://assets.davit.ie/domains/davit.ie/header-bg.webp
```

---

# 3. Folder Structure

## 3.1 Local Development Project (`davit-sass-web-start`)
```
project/
│
├── public/                   # runtime local assets
│   ├── img/
│   ├── icons/
│   └── favicon/
│
├── src/                      # editable code
│   ├── html/
│   ├── js/
│   ├── assets-dev/           # editable source assets
│   │    ├── images/
│   │    ├── icons/
│   │    └── favicon/
│   └── templates/
│
├── dist/                     # dev build output
├── stage/                    # staging build for QA
├── build/                    # production build
└── archive/                  # versioned historic builds
```

## 3.2 Central Asset Repository (`assets.davit.ie`)
```
assets.davit.ie/
│
├── global/                   # shared by all projects
│   ├── favicon/
│   ├── icons/
│   └── images/
│
├── brands/                   # brand‑specific packages
│   ├── corp/
│   ├── productA/
│   └── productB/
│
└── domains/                  # domain-specific overrides
    ├── davit.ie/
    └── davit.in/
```

---

# 4. Build Pipeline

### **dist/**
- Auto-generated development output
- Lightweight, fast, unminified

### **stage/**
- A QA-ready build
- Minified and optimised
- Mirrors expected production structure

### **build/**
- Final deployable artifact
- Version‑locked
- Uses CDN references where appropriate

### **archive/**
- Stores historic versions using semantic versioning
- Example:
```
archive/v1.0.0/
archive/v1.1.0/
```

---

# 5. GitHub Pages Project Skeleton (No Sass Yet)

For repository: **`DavitTec/davit-sass-web-start`**

```
davit-sass-web-start/
│
├── public/
│   ├── img/
│   ├── favicon/
│   └── index.html           # served by GitHub Pages
│
├── src/
│   ├── html/
│   ├── js/
│   └── assets-dev/
│
├── dist/
├── stage/
├── build/
│
├── package.json
├── pnpm-lock.yaml
└── README.md
```

### Example `public/index.html`
```html
<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DAVIT Web Start</title>
  <link rel="icon" href="/favicon/favicon.ico" />
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <header>
    <h1>DAVIT Web Start</h1>
  </header>

  <script src="/main.js"></script>
</body>
</html>
```

### Example `public/style.css`
```css
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 2rem;
}
```

### Example `public/main.js`
```javascript
console.log("DAVIT Web Start Loaded");
```

This skeleton is fully compatible with GitHub Pages.

---

# 6. GitHub Actions Workflow (pnpm + Build + Deploy)

Create: `.github/workflows/deploy.yml`

```yaml
name: Build and Deploy

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm'

      - name: Install pnpm
        uses: pnpm/action-setup@v3
        with:
          version: 8

      - name: Install Dependencies
        run: pnpm install

      - name: Build Project
        run: |
          pnpm build
          # example: pnpm build should output to build/

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
```

**Notes:**
- `publish_dir` can later be changed to `build/` when Sass build is added.
- Currently, we deploy the `public/` folder only (HTML-only stage).

---

# 7. PNPM Scripts Template

Example `package.json` block:

```json
{
  "scripts": {
    "dev": "live-server public --port=8081 --host=127.0.0.1",
    "build": "node ./scripts/build.js",
    "clean": "rimraf dist stage build"
  }
}
```

Later, when Sass is added:
```
"sass": "sass src/sass/main.sass dist/css/main.css"
```

---

# 8. Summary
This policy defines:
- A stable asset taxonomy
- A multi-domain CDN structure (`assets.davit.ie`)
- Clean project folder layout with clear singular/plural rules
- A complete GitHub Pages‑ready structure
- A pnpm‑based automated build and deployment pipeline

This document is intended to remain valid as DAVIT expands into multi-domain, multi-brand, and multi-theme architectures.

